<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to TockyRandomForest Analysis • TockyRandomForest</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to TockyRandomForest Analysis">
<meta name="google-site-verification" content="Pj4WWF5m9cqCcPqkGG75BI1_593zXImuFRpI8TnAous">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">TockyRandomForest</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/MonoTockyLab/TockyRandomForest/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introduction to TockyRandomForest Analysis</h1>
                        <h4 data-toc-skip class="author">Dr. Masahiro
Ono</h4>
            
            <h4 data-toc-skip class="date">2025-01-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/MonoTockyLab/TockyRandomForest/blob/HEAD/vignettes/TockyRandomForest.Rmd" class="external-link"><code>vignettes/TockyRandomForest.Rmd</code></a></small>
      <div class="d-none name"><code>TockyRandomForest.Rmd</code></div>
    </div>

    
    
<p><img src="assets%2FTockyRandomForest.png" style="width:80.0%" align="center"></p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Fluorescent Timer proteins uniquely change their emission spectra
over time, serving as powerful tools for monitoring dynamic processes
within cells. Our recent efforts have successfully implemented data
preprocessing methods in the <strong>TockyPrep</strong> package (<span class="citation">Ono (<a href="#ref-TockyPrep2024">2024b</a>)</span>).
Additionally, to analyze Timer fluorescence dynamics and apply
quantitative and statistical analysis methods, we have developed the
<strong>TockyLocus</strong> package (<span class="citation">Ono (<a href="#ref-TockyLocus2024">2024a</a>)</span>). However, analyzing
complex Timer profiles, as typically seen in flow cytometric data from
Foxp3-Tocky mice, remains challenging.</p>
<p><strong>Aim</strong></p>
<p>To overcome these challenges, applying machine learning methods is an
attractive approach. The current package family,
<strong>TockyMachineLearning</strong>, provides comprehensive methods
for identifying feature cells that represent group-specific features in
Timer profiles. Specifically, the <strong>TockyRandomForest</strong>
package offers Random Forest methods developed for analyzing flow
cytometric Fluorescent Timer data.</p>
<div class="section level3">
<h3 id="relationship-to-the-packages-tockyprep-and-tockylocus">Relationship to the Packages TockyPrep and TockyLocus<a class="anchor" aria-label="anchor" href="#relationship-to-the-packages-tockyprep-and-tockylocus"></a>
</h3>
<p>The <strong>TockyPrep</strong> package is designed to facilitate data
preprocessing for flow cytometric Fluorescent Timer data. Subsequently,
the <strong>TockyLocus</strong> package leverages this preprocessed data
to apply data categorization methods, enabling quantitative analysis of
Timer Angle data (<span class="citation">Bending et al. (<a href="#ref-Bending2018a">2018</a>)</span>). However, this approach is
applicable to one-dimensional data only.</p>
<p>The <strong>TockyRandomForest</strong> package utilizes the special
object class provided by the <strong>TockyPrep</strong> package to
perform advanced analyses on multi-dimensional data.</p>
</div>
<div class="section level3">
<h3 id="getting-started-with-tockyrandomforest">Getting Started with <strong>TockyRandomForest</strong><a class="anchor" aria-label="anchor" href="#getting-started-with-tockyrandomforest"></a>
</h3>
<p>To begin using <strong>TockyRandomForest</strong>, you need to
install both the TockyRandomForest and TockyPrep packages from
GitHub:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install TockyPrep and TockyRandomForest from GitHub</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"MonoTockyLab/TockyPrep"</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"MonoTockyLab/TockyRandomForest"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="sample-workflow">Sample Workflow<a class="anchor" aria-label="anchor" href="#sample-workflow"></a>
</h3>
<p>This section guides you through a typical analysis workflow using
<strong>TockyRandomForest</strong> to process flow cytometric data of
cells expressing Fluorescent Timer proteins. To facilitate the analysis,
preprocessed data are provided, and the <strong>TockyPrep</strong>
package offers methods to analyze data using its S4 object class
<code>TockyPrepData</code>.</p>
<p>First, load the necessary packages.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/MonoTockyLab/TockyPrep" class="external-link">TockyPrep</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/MonoTockyLab/TockyRandomForest" class="external-link">TockyRandomForest</a></span><span class="op">)</span></span></code></pre></div>
<p>Load example data included in the <strong>TockyRandomForest</strong>
package as follows:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example data load</span></span>
<span><span class="co"># Define the base path</span></span>
<span><span class="va">file_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"TockyRandomForest"</span><span class="op">)</span></span>
<span><span class="va">filenames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">file_path</span>, pattern <span class="op">=</span> <span class="st">'rda'</span><span class="op">)</span></span>
<span><span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">file_path</span>, <span class="va">filenames</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">files</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">}</span></span></code></pre></div>
<p>The dataset was generated by analyzing T-cells from Foxp3-Tocky mice
(WT) and CRISPR-mediated Foxp3-Tocky mutants, specifically CNS2KO
Foxp3-Tocky mice (KO).</p>
</div>
<div class="section level3">
<h3 id="tockykmeansrf-analysis">TockyKmeansRF Analysis<a class="anchor" aria-label="anchor" href="#tockykmeansrf-analysis"></a>
</h3>
<p>Use the <code>TockyKmeansRF</code> function to apply TockyKmeansRF to
your data:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TockyKmeansRF.html">TockyKmeansRF</a></span><span class="op">(</span><span class="va">trainData</span>, <span class="va">testData</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Train Data: </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">##  randomForest(formula = group ~ ., data = cluster_train_data_wide,      ntree = 100) </span></span>
<span><span class="co">##                Type of random forest: classification</span></span>
<span><span class="co">##                      Number of trees: 100</span></span>
<span><span class="co">## No. of variables tried at each split: 2</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##         OOB estimate of  error rate: 0%</span></span>
<span><span class="co">## Confusion matrix:</span></span>
<span><span class="co">##    KO WT class.error</span></span>
<span><span class="co">## KO 14  0           0</span></span>
<span><span class="co">## WT  0 12           0</span></span>
<span><span class="co">## Test Data: </span></span>
<span><span class="co">##     test_predictions</span></span>
<span><span class="co">##      KO WT</span></span>
<span><span class="co">##   KO  8 12</span></span>
<span><span class="co">##   WT  0 14</span></span>
<span><span class="co">## [1] "Accuracy: 0.647058823529412"</span></span></code></pre>
<p>A single analysis using <code>TockyKmeansRF</code> may not yield
highly efficient results for the test dataset.</p>
</div>
<div class="section level3">
<h3 id="tockykmeansrf-cluster-optimization">TockyKmeansRF Cluster Optimization<a class="anchor" aria-label="anchor" href="#tockykmeansrf-cluster-optimization"></a>
</h3>
<p>You can optimize the number of clusters to use by employing the
<code>TockyRFClusterOptimization</code> function:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">roc_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TockyRFClusterOptimization.html">TockyRFClusterOptimization</a></span><span class="op">(</span><span class="va">trainData</span>, <span class="va">testData</span>, num_cluster_vec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">12</span>, <span class="fl">15</span>, <span class="fl">20</span>, <span class="fl">25</span>, <span class="fl">30</span><span class="op">)</span>, k <span class="op">=</span> <span class="fl">50</span>, ctrl_group <span class="op">=</span> <span class="st">'KO'</span>, expr_group <span class="op">=</span> <span class="st">'WT'</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span>grobs <span class="op">=</span> <span class="va">roc_results</span><span class="op">$</span><span class="va">roc_plots</span><span class="op">)</span></span></code></pre></div>
<p><img src="TockyRandomForest_files/figure-html/TockyRFClusterOptimization-1.png" width="768"></p>
</div>
<div class="section level3">
<h3 id="tockyrandomforest-analysis-for-feature-cell-identification">TockyRandomForest Analysis for Feature Cell Identification<a class="anchor" aria-label="anchor" href="#tockyrandomforest-analysis-for-feature-cell-identification"></a>
</h3>
<p>In the following sections, we will use the cluster number 15.</p>
<p>Use the <code>TockyRandomForestAnalysis</code> function to
iteratively apply <code>TockyKmeansRF</code> to your data:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TockyRandomForestAnalysis.html">TockyRandomForestAnalysis</a></span><span class="op">(</span><span class="va">trainData</span>, <span class="va">testData</span>, percentile <span class="op">=</span> <span class="fl">0.5</span>, num_cluster <span class="op">=</span> <span class="fl">15</span>, k <span class="op">=</span> <span class="fl">50</span>, ROC <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span>, ctrl_group <span class="op">=</span> <span class="st">'KO'</span>, expr_group <span class="op">=</span> <span class="st">'WT'</span><span class="op">)</span></span></code></pre></div>
<p><img src="TockyRandomForest_files/figure-html/TockyRandomForestAnalysis-1.png" width="768"></p>
<p>Use the <code>plotTockyRandomForestAnalysis</code> function to plot
the output.</p>
<p>Using the option
<code>plot = 'Importance Score', raw_timer = TRUE</code>, feature cells
can be visualized in Timer blue and red fluorescence data.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotTockyRandomForestAnalysis.html">plotTockyRandomForestAnalysis</a></span><span class="op">(</span><span class="va">trainData</span>, <span class="va">result</span>, percentile <span class="op">=</span> <span class="fl">0.5</span>, select <span class="op">=</span> <span class="cn">FALSE</span>, plot <span class="op">=</span> <span class="st">'Importance Score'</span>, raw_timer <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span></code></pre></div>
<p><img src="TockyRandomForest_files/figure-html/plotTockyRandomForestAnalysis_timer-1.png" width="768"></p>
<p>Using the option <code>plot = 'ROC'</code>, the ROC curve can be
plotted.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotTockyRandomForestAnalysis.html">plotTockyRandomForestAnalysis</a></span><span class="op">(</span><span class="va">trainData</span>, <span class="va">result</span>, percentile <span class="op">=</span> <span class="fl">0.5</span>, select <span class="op">=</span> <span class="cn">FALSE</span>, plot <span class="op">=</span> <span class="st">'ROC'</span><span class="op">)</span></span></code></pre></div>
<p><img src="TockyRandomForest_files/figure-html/plotTockyRandomForestAnalysis-1.png" width="384"></p>
<div class="section level4">
<h4 id="clustering-feature-cells">Clustering Feature Cells<a class="anchor" aria-label="anchor" href="#clustering-feature-cells"></a>
</h4>
<p>Next, use the output object <code>result</code> from
<code>TockyRandomForestAnalysis</code> to cluster feature cells using
DBScan clustering.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cluster_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clusteringFeatureCells.html">clusteringFeatureCells</a></span><span class="op">(</span><span class="va">trainData</span>, <span class="va">result</span>, percentile <span class="op">=</span> <span class="fl">0.5</span>, eps_value <span class="op">=</span> <span class="fl">2</span>, minPts_value <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p><img src="TockyRandomForest_files/figure-html/clusteringFeatureCells-1.png" width="768"></p>
</div>
</div>
<div class="section level3">
<h3 id="convex-hull-gating-for-feature-cells">Convex Hull Gating for Feature Cells<a class="anchor" aria-label="anchor" href="#convex-hull-gating-for-feature-cells"></a>
</h3>
<p>To use a convex hull gating approach, obtain cluster IDs and
importance scores from the analyses above.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cluster_ids</span> <span class="op">&lt;-</span> <span class="va">cluster_result</span><span class="op">$</span><span class="va">cluster</span></span>
<span><span class="va">cluster_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="fl">0</span>, replacement <span class="op">=</span> <span class="fl">2</span>, <span class="va">cluster_ids</span><span class="op">)</span></span>
<span><span class="va">importance_scores</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">importance_score</span></span></code></pre></div>
<p>Then use <code>plotHullsGating</code> to analyze the percentage of
cells falling in each of the hull-gated feature cell clusters per
sample.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plotHullsGating.html">plotHullsGating</a></span><span class="op">(</span><span class="va">trainData</span>, importance_scores <span class="op">=</span> <span class="va">importance_scores</span>, cell_cluster_id <span class="op">=</span> <span class="va">cluster_ids</span><span class="op">)</span></span></code></pre></div>
<p><img src="TockyRandomForest_files/figure-html/plotHullsGating-1.png" width="480"></p>
<p>The output object from the <code>plotHullsGating</code> function
includes violin plots that illustrate the group effects on the
percentage of cells within each cluster. These plots are stored as a
list object and can be organized into a grid layout using the
<code>gridExtra</code> package. You can display them as follows:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span>grobs <span class="op">=</span> <span class="va">output</span><span class="op">$</span><span class="va">plot</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Removed 5 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_violin()`).</span></span></code></pre>
<p><img src="TockyRandomForest_files/figure-html/gridExtra-1.png" width="768"></p>
<p>The statistical output can be accessed as follows:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/methods/show.html" class="external-link">show</a></span><span class="op">(</span><span class="va">output</span><span class="op">$</span><span class="va">stats</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   Cluster     p_values   p_adjusted</span></span>
<span><span class="co">## 1       1 4.038229e-05 4.038229e-05</span></span>
<span><span class="co">## 2       2 2.070886e-07 4.141773e-07</span></span></code></pre>
<p><img src="assets%2FMonoLab.jpg" style="width:40.0%" align="center"><br><img src="assets%2Ftockymachinelearning.jpg" style="width:70.0%" align="center"></p>
</div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Bending2018a" class="csl-entry">
Bending, David, Paz Prieto Martin, Alina Paduraru, Catherine Ducker,
Erik Marzaganov, Marie Laviron, Satsuki Kitano, Hitoshi Miyachi, Tessa
Crompton, and Masahiro Ono. 2018. <span>“A Timer for Analyzing
Temporally Dynamic Changes in Transcription During Differentiation in
Vivo.”</span> <em>Journal of Cell Biology</em> 217 (8): 2931–50.
</div>
<div id="ref-TockyLocus2024" class="csl-entry">
Ono, Masahiro. 2024a. <span>“TockyLocus: Quantitative Analysis Methods
for Flow Cytometric Fluorescent Timer Data.”</span> <a href="https://arxiv.org/abs/2411.09386" class="external-link">https://arxiv.org/abs/2411.09386</a>.
</div>
<div id="ref-TockyPrep2024" class="csl-entry">
———. 2024b. <span>“TockyPrep: Data Preprocessing Methods for Flow
Cytometric Fluorescent Timer Analysis.”</span> <a href="https://arxiv.org/abs/2411.04111" class="external-link">https://arxiv.org/abs/2411.04111</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://monotockylab.github.io/" class="external-link">Masahiro Ono</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
